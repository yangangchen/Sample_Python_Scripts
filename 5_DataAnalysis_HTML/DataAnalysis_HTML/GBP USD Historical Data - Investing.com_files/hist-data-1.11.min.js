// File: hist-data.js
window.historicalDataCurrentSort=[0,1],$(function(){function a(a,c){var i,j,k=!a,l=$.datepicker.regional[""].dateFormat,m=new Date,n=new Date,o=30,p=g.val();if(!d||k){var q=$.datepicker._getFromToDates($.datepicker._curInst,"yy-mm-dd");null!==q&&(n=q.dateFrom,m=q.dateTo)}else"Weekly"===g.val()&&(o=364),"Monthly"===g.val()&&(o=720),j=new Date,j.setDate(j.getDate()-o),n=j;i={fromInputStr:$.datepicker.formatDate(l,n),toInputStr:$.datepicker.formatDate(l,m)},$("#picker").val(i.fromInputStr+" - "+i.toInputStr),$("#widgetFieldDateRange").text($("#picker").val()),window.savedDownloadParams={curr_id:window.histDataExcessInfo.pairId,smlID:window.histDataExcessInfo.smlId,header:$("h2").html(),st_date:i.fromInputStr,end_date:i.toInputStr,interval_sec:p,sort_col:h[window.historicalDataCurrentSort[0]],sort_ord:window.historicalDataCurrentSort[1]?"DESC":"ASC"},c&&c.is("download")?siteData.userLoggedIn?document.location.href="/instruments/DownloadHistoricalData?"+$.param(window.savedDownloadParams):(overlay.overlayLogin(),overlay.authCompleteAction={type:"historicalData",actionData:window.savedDownloadParams}):(f.html(e),$.post("/instruments/HistoricalDataAjax",$.extend(window.savedDownloadParams,{action:"historical_data"}),b,"text"))}function b(a){f.html(a.replace('<div id="results_box">',"").replace(/<\/div>/,""))}var c=new MyDatePicker("#picker","#widgetFieldDateRange",siteData.datepicker.format,(new Date).addMonths(-1),new Date,siteData.datepicker.translations),d=!0,e='<div class="loading-responsive medium-circle tableLoading"></div>',f=$("#results_box"),g=$("#data_interval"),h=[];$("#curr_table>thead th").each(function(){h.push($(this).data("colName"))}),c.setPickerType(2),c.setTrigger("#flatDatePickerCanvasHol"),c.setFirstDay(siteData.datepicker.firstDay),c.setDayNames(siteData.datepicker.dayNames),c.setRtl(siteData.htmlDirection),c.setMonthNamesShort(siteData.datepicker.monthNamesShort),c.setMonthNames(siteData.datepicker.monthNames),c.setApplyButtonText(siteData.datepicker.applyButton),c.attachTo("rtl"==siteData.htmlDirection?"opposite":"normal",0,0,1,"#flatDatePickerCanvasHol"),c.setMaxDate(0),c.setMinDate(new Date(0)),c.create(),$(c.input).on("onClose",function(b,c,e,f,g){g&&(a(),d=!1)}),window.savedDownloadParams&&a(!0,"download"),g.change(function(){a(!0)}),$(".js-download-hist-data").click(function(){a(!0,"download")})});