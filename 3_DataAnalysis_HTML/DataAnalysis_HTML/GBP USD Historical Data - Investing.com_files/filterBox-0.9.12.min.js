// File: filterBox.js
loader([{type:"$",value:".js-filter-box"}]).ready(function(a){function b(){var b,c=l.find("A.selected").attr("continentid"),d=a.find(".js-etf-country-filter option:selected").attr("country_id"),e=a.find(".js-issuer-filter option:selected").val(),f=a.find(".js-asset-filter option:selected").val(),h=!1,i=a.find(".js-underlying-filter");a.find("select").prop("disabled",!0),i.length&&!i.hasClass("displayNone")&&(h=i.find("option:selected").val()),b={action:"etfsFilter",continent_id:c,country_id:d,issuer:e,asset:f,underlying:h},$.get("/common/ajax_func.php",b,function(b){a.find(".js-inner-filters").html(b),g()})}function c(){var b=l.find("A.selected").attr("continentid"),c=+a.find(".js-fund-country-filter option:selected").attr("country_id"),d=a.find(".js-issuer-filter option:selected").val(),e=+a.find(".js-asset-filter option:selected").val(),f=+a.find(".js-rating-filter option:selected").val(),h=+a.find(".js-risk-rating-filter option:selected").val(),i={action:"fundsFilter",continent_id:b,country_id:c,issuer:d,asset:e,rating:f,riskRating:h};a.find("select").prop("disabled",!0),$.get("/common/ajax_func.php",i,function(b){a.find(".js-inner-filters").html(b),g()})}function d(){var b=a.find(".js-etf-country-filter option:selected").val()+"?",c=+a.find(".js-asset-filter option:selected").val(),d=a.find(".js-issuer-filter option:selected").val(),e=+a.find(".js-underlying-filter option:selected").val();c&&(b+="&asset="+c),d&&(b+="&issuer_filter="+d),e&&(b+="&filter="+e),window.location=encodeURI(b)}function e(){var b=a.find(".js-fund-country-filter option:selected").val()+"?",c=+a.find(".js-asset-filter option:selected").val(),d=a.find(".js-issuer-filter option:selected").val(),e=+a.find(".js-rating-filter option:selected").val(),f=+a.find(".js-risk-rating-filter option:selected").val();c&&(b+="&asset="+c),d&&(b+="&issuer_filter="+d),e>-1&&(b+="&rating="+e),f>-1&&(b+="&riskRating="+f),window.location=encodeURI(b)}function f(){var b=a.find(".js-indice-country-filter option:selected").val()+"?";a.find('.filter input[type="checkbox"]:checked').each(function(){b+="&"+$(this).attr("name")+"=on"}),window.location=encodeURI(b)}function g(){switch(k){case"indice":a.find(".js-search-indices").on("click",f);break;case"bond":a.find(".js-bond-country-filter").on("change",i),a.find(".js-search-bonds").on("click",j);break;case"etf":a.find("select").on("change",b),a.find(".js-search-etfs").on("click",d),a.find("select").prop("disabled",!1);break;case"fund":a.find("select").on("change",c),a.find(".js-search-funds").on("click",e),a.find("select").prop("disabled",!1)}}function h(b,c){if("currencyExplorer"==c)return changeCurrency(b);var d,e,f=$(b).data("smlId"),i=$(b).attr("continentid");$(b).addClass("selected").siblings().each(function(){$(this).removeClass("selected")}),$(b).unbind("click").siblings().each(function(){$(this).unbind("click"),$(this).bind({click:function(){h(this,c)}})}),$(window).trigger("multiFilter-ChangeFilterTypeAction",[b,f,c]),c.is("bond")?(changeBondsSelectFilter("all"),d={action:"bondsFilter",newSml:f,maturity_from:$("#newFilter #filter_maturity_from").val(),maturity_to:$("#newFilter #filter_maturity_to").val(),continentID:i},e=function(b){a.find(".js-inner-filters").html(b),g(),changeBondsSelectFilter("all")}):c.is("etf")?(d={action:"etfsFilter",continent_id:i},e=function(b){a.find(".js-inner-filters").html(b),g()}):c.is("fund")?(d={action:"fundsFilter",continent_id:i},e=function(b){a.find(".js-inner-filters").html(b),g()}):c.is("indice")?(setFilter(),d={action:"indicesFilter",newSml:f,majorIndices:$("#newFilter #filter_majorIndices").val(),additionalIndices:$("#newFilter #filter_additionalIndices").val(),primarySectors:$("#newFilter #filter_primarySectors").val(),otherIndices:$("#newFilter #filter_otherIndices").val()},e=function(b){a.find(".js-inner-filters").html(b),g()}):c.is("central-bank")?(d={action:"worldCentralBankFilter",newSml:f,continent_id:i},e=function(a){$("#directoryFilter").html(a)}):c.is("global")?(setFilter(),d={action:"globalIndicesFilter",newSml:f,majorIndices:$("#newFilter #filter_majorIndices").val(),additionalIndices:$("#newFilter #filter_additionalIndices").val(),primarySectors:$("#newFilter #filter_primarySectors").val(),otherIndices:$("#newFilter #filter_otherIndices").val(),bonds:$("#newFilter #filter_bonds").val(),commodities:$("#newFilter #filter_commodities").val()},e=function(a){$("#directoryFilter").html(a),setFilter()}):c.is("bond indicesbonds")&&(changeBondsSelectFilter("all"),d={action:"indicesbondsFilter",newSml:f,continentID:$(b).attr("continentid")},e=function(a){$("#directoryFilter").html(a),changeBondsSelectFilter("all")}),d&&$.get("/common/ajax_func.php",d,e)}function i(){var b=l.find(".selected").attr("continentid"),c=+$(this).find("option:selected").attr("exchangeid"),d=a.find(".js-bond-country-filter option").filter(":selected").val();b||(b=0),$.get("/common/ajax_func.php",{action:"updateBondsMaturities",exchange_ID:c,continentID:b,country:d},function(b){a.find(".js-inner-filters").html(b),g()})}function j(){var b=a.find(".js-bond-country-filter option").filter(":selected").val()+"?";b+="maturity_from="+a.find(".js-maturity-from-filter option:selected").val(),b+="&maturity_to="+a.find(".js-maturity-to-filter option:selected").val(),window.location=encodeURI(b)}var k=a.attr("data-section"),l=a.find(".js-filter-box-table");if(!a.attr("data-populated"))switch(k){case"etf":a.find(".js-etf-country-filter").val(0),a.find(".js-issuer-filter").val(0),a.find(".js-asset-filter").val(0);break;case"indice":a.find(".js-indice-country-filter").val(0);break;case"bond":a.find(".js-bond-filter").val(0);break;case"fund":a.find(".js-fund-country-filter").val(0),a.find(".js-issuer-filter").val(0),a.find(".js-asset-filter").val(0),a.find(".js-rating-filter").val(-1),a.find(".js-risk-rating-filter").val(-1)}g(),l.find("A").on("click",function(){h($(this),a.attr("data-section"))})});